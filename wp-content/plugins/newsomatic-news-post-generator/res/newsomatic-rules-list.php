<?php
$encodings=array("ANSI_X3.4-1968 ANSI_X3.4-1986 ASCII CP367 IBM367 ISO-IR-6 ISO646-US ISO_646.IRV:1991 US US-ASCII CSASCII","UTF-8","ISO-10646-UCS-2 UCS-2 CSUNICODE","UCS-2BE UNICODE-1-1 UNICODEBIG CSUNICODE11","UCS-2LE UNICODELITTLE","ISO-10646-UCS-4 UCS-4 CSUCS4","UCS-4BE","UCS-4LE","UTF-16","UTF-16BE","UTF-16LE","UTF-32","UTF-32BE","UTF-32LE","UNICODE-1-1-UTF-7 UTF-7 CSUNICODE11UTF7","UCS-2-INTERNAL","UCS-2-SWAPPED","UCS-4-INTERNAL","UCS-4-SWAPPED","C99","JAVA","CP819 IBM819 ISO-8859-1 ISO-IR-100 ISO8859-1 ISO_8859-1 ISO_8859-1:1987 L1 LATIN1 CSISOLATIN1","ISO-8859-2 ISO-IR-101 ISO8859-2 ISO_8859-2 ISO_8859-2:1987 L2 LATIN2 CSISOLATIN2","ISO-8859-3 ISO-IR-109 ISO8859-3 ISO_8859-3 ISO_8859-3:1988 L3 LATIN3 CSISOLATIN3","ISO-8859-4 ISO-IR-110 ISO8859-4 ISO_8859-4 ISO_8859-4:1988 L4 LATIN4 CSISOLATIN4","CYRILLIC ISO-8859-5 ISO-IR-144 ISO8859-5 ISO_8859-5 ISO_8859-5:1988 CSISOLATINCYRILLIC","ARABIC ASMO-708 ECMA-114 ISO-8859-6 ISO-IR-127 ISO8859-6 ISO_8859-6 ISO_8859-6:1987 CSISOLATINARABIC","ECMA-118 ELOT_928 GREEK GREEK8 ISO-8859-7 ISO-IR-126 ISO8859-7 ISO_8859-7 ISO_8859-7:1987 ISO_8859-7:2003 CSISOLATINGREEK","HEBREW ISO-8859-8 ISO-IR-138 ISO8859-8 ISO_8859-8 ISO_8859-8:1988 CSISOLATINHEBREW","ISO-8859-9 ISO-IR-148 ISO8859-9 ISO_8859-9 ISO_8859-9:1989 L5 LATIN5 CSISOLATIN5","ISO-8859-10 ISO-IR-157 ISO8859-10 ISO_8859-10 ISO_8859-10:1992 L6 LATIN6 CSISOLATIN6","ISO-8859-11 ISO8859-11 ISO_8859-11","ISO-8859-13 ISO-IR-179 ISO8859-13 ISO_8859-13 L7 LATIN7","ISO-8859-14 ISO-CELTIC ISO-IR-199 ISO8859-14 ISO_8859-14 ISO_8859-14:1998 L8 LATIN8","ISO-8859-15 ISO-IR-203 ISO8859-15 ISO_8859-15 ISO_8859-15:1998 LATIN-9","ISO-8859-16 ISO-IR-226 ISO8859-16 ISO_8859-16 ISO_8859-16:2001 L10 LATIN10","KOI8-R CSKOI8R","KOI8-U","KOI8-RU","CP1250 MS-EE WINDOWS-1250","CP1251 MS-CYRL WINDOWS-1251","CP1252 MS-ANSI WINDOWS-1252","CP1253 MS-GREEK WINDOWS-1253","CP1254 MS-TURK WINDOWS-1254","CP1255 MS-HEBR WINDOWS-1255","CP1256 MS-ARAB WINDOWS-1256","CP1257 WINBALTRIM WINDOWS-1257","CP1258 WINDOWS-1258","850 CP850 IBM850 CSPC850MULTILINGUAL","862 CP862 IBM862 CSPC862LATINHEBREW","866 CP866 IBM866 CSIBM866","MAC MACINTOSH MACROMAN CSMACINTOSH","MACCENTRALEUROPE","MACICELAND","MACCROATIAN","MACROMANIA","MACCYRILLIC","MACUKRAINE","MACGREEK","MACTURKISH","MACHEBREW","MACARABIC","MACTHAI","HP-ROMAN8 R8 ROMAN8 CSHPROMAN8","NEXTSTEP","ARMSCII-8","GEORGIAN-ACADEMY","GEORGIAN-PS","KOI8-T","CP154 CYRILLIC-ASIAN PT154 PTCP154 CSPTCP154","KZ-1048 RK1048 STRK1048-2002 CSKZ1048","MULELAO-1","CP1133 IBM-CP1133","ISO-IR-166 TIS-620 TIS620 TIS620-0 TIS620.2529-1 TIS620.2533-0 TIS620.2533-1","CP874 WINDOWS-874","VISCII VISCII1.1-1 CSVISCII","TCVN TCVN-5712 TCVN5712-1 TCVN5712-1:1993","ISO-IR-14 ISO646-JP JIS_C6220-1969-RO JP CSISO14JISC6220RO","JISX0201-1976 JIS_X0201 X0201 CSHALFWIDTHKATAKANA","ISO-IR-87 JIS0208 JIS_C6226-1983 JIS_X0208 JIS_X0208-1983 JIS_X0208-1990 X0208 CSISO87JISX0208","ISO-IR-159 JIS_X0212 JIS_X0212-1990 JIS_X0212.1990-0 X0212 CSISO159JISX02121990","CN GB_1988-80 ISO-IR-57 ISO646-CN CSISO57GB1988","CHINESE GB_2312-80 ISO-IR-58 CSISO58GB231280","CN-GB-ISOIR165 ISO-IR-165","ISO-IR-149 KOREAN KSC_5601 KS_C_5601-1987 KS_C_5601-1989 CSKSC56011987","EUC-JP EUCJP EXTENDED_UNIX_CODE_PACKED_FORMAT_FOR_JAPANESE CSEUCPKDFMTJAPANESE","MS_KANJI SHIFT-JIS SHIFT_JIS SJIS CSSHIFTJIS","CP932","ISO-2022-JP CSISO2022JP","ISO-2022-JP-1","ISO-2022-JP-2 CSISO2022JP2","CN-GB EUC-CN EUCCN GB2312 CSGB2312","GBK","CP936 MS936 WINDOWS-936","GB18030","ISO-2022-CN CSISO2022CN","ISO-2022-CN-EXT","HZ HZ-GB-2312","EUC-TW EUCTW CSEUCTW","BIG-5 BIG-FIVE BIG5 BIGFIVE CN-BIG5 CSBIG5","CP950","BIG5-HKSCS:1999","BIG5-HKSCS:2001","BIG5-HKSCS BIG5-HKSCS:2004 BIG5HKSCS","EUC-KR EUCKR CSEUCKR","CP949 UHC","CP1361 JOHAB","ISO-2022-KR CSISO2022KR","CP856","CP922","CP943","CP1046","CP1124","CP1129","CP1161 IBM-1161 IBM1161 CSIBM1161","CP1162 IBM-1162 IBM1162 CSIBM1162","CP1163 IBM-1163 IBM1163 CSIBM1163","DEC-KANJI","DEC-HANYU","437 CP437 IBM437 CS","PC8CODEPAGE437","CP737","CP775 IBM775 CSPC775BALTIC","852 CP852 IBM852 CSPCP852","CP853","855 CP855 IBM855 CSIBM855","857 CP857 IBM857 CSIBM857","CP858","860 CP860 IBM860 CSIBM860","861 CP-IS CP861 IBM861 CSIBM861","863 CP863 IBM863 CSIBM863","CP864 IBM864 CSIBM864","865 CP865 IBM865 CSIBM865","869 CP-GR CP869 IBM869 CSIBM869","CP1125","EUC-JISX0213","SHIFT_JISX0213","ISO-2022-JP-3","BIG5-2003","ISO-IR-230 TDS565","ATARI ATARIST","RISCOS-LATIN1");
function newsomatic_items_panel()
{
$newsomatic_Main_Settings = get_option('newsomatic_Main_Settings', false);
if(isset($newsomatic_Main_Settings['app_id']) && $newsomatic_Main_Settings['app_id'] != '')
{
}
else
{
?>
<h1>You must add a NewsAPI API Key before you can use this feature!</h1>
<?php
return;
}
?>
<div class="wrap gs_popuptype_holder seo_pops">
    <div>
        <form id="myForm" method="post" action="admin.php?page=newsomatic_items_panel">
<?php
    wp_nonce_field('newsomatic_save_rules', '_newsomaticr_nonce');
    
?>
<script>
				jQuery(document).ready(function(){
					jQuery('span.wpnewsomatic-delete').html('X').css({'color':'red','cursor':'pointer'}).click(function(){
						var confirm_delete = confirm('Delete This Rule?');
						if (confirm_delete) {
							jQuery(this).parent().parent().remove();
							jQuery('#myForm').submit();						
						}
					});
				});
                var unsaved = false;
                jQuery(document).ready(function () {
                    jQuery(":input").change(function(){
                        var classes = this.className;
                        var classes = this.className.split(' ');
                        var found = jQuery.inArray('actions', classes) > -1;
                        if(!found)
                            unsaved = true;
                    });
                    function unloadPage(){ 
                        if(unsaved){
                            return "You have unsaved changes on this page. Do you want to leave this page and discard your changes or stay on this page?";
                        }
                    }
                    window.onbeforeunload = unloadPage;
                });
			</script>
            <script type="text/javascript" >
                        function deletePostsManual(number, type)
                        {
                            if (confirm("Are you sure you want to delete all posts generated by this rule?") == true) {
                                document.getElementById("run_img" + number).style.visibility = "visible";
                                document.getElementById("run_img" + number).src="<?php
    echo plugin_dir_url(dirname(__FILE__)) . 'images/running.gif';
?>";
                                var data = {
                                    action: 'newsomatic_my_action',
                                    id: number,
                                    type: 0,
                                    how: type
                                };
                                jQuery.post(ajaxurl, data, function(response) {
                                    if(response == 'ok')
                                    {
                                        document.getElementById("run_img" + number).src="<?php
    echo plugin_dir_url(dirname(__FILE__)) . 'images/ok.gif';
?>";
                                    }
                                    else
                                    {
                                        if(response == 'nochange')
                                        {
                                            document.getElementById("run_img" + number).src="<?php
    echo plugin_dir_url(dirname(__FILE__)) . 'images/nochange.gif';
?>";
                                        }
                                        else
                                        {
                                            document.getElementById("run_img" + number).src="<?php
    echo plugin_dir_url(dirname(__FILE__)) . 'images/failed.gif';
?>";
                                        }
                                    }
                                });
                            } else {
                                return;
                            }
                        }
                        function runNowManual(number)
                        {
                            if (confirm("Are you sure you want to run now this rule?") == true) {
                                document.getElementById("run_img" + number).style.visibility = "visible";
                                document.getElementById("run_img" + number).src="<?php
    echo plugin_dir_url(dirname(__FILE__)) . 'images/running.gif';
?>";
                                var data = {
                                    action: 'newsomatic_run_my_action',
                                    id: number
                                };
                                jQuery.post(ajaxurl, data, function(response) {
                                    if(response == 'ok')
                                    {
                                        document.getElementById("run_img" + number).src="<?php
    echo plugin_dir_url(dirname(__FILE__)) . 'images/ok.gif';
?>";
                                    }
                                    else
                                    {
                                        if(response == 'nochange')
                                        {
                                            document.getElementById("run_img" + number).src="<?php
    echo plugin_dir_url(dirname(__FILE__)) . 'images/nochange.gif';
?>";
                                        }
                                        else
                                        {
                                            document.getElementById("run_img" + number).src="<?php
    echo plugin_dir_url(dirname(__FILE__)) . 'images/failed.gif';
?>";
                                        }
                                    }
                                });
                            } else {
                                return;
                            }
                        }
            function mainChanged()
                {
                    if(jQuery('#full_content').is(":checked"))
                    {            
                        jQuery(".hideFull").show();
                    }
                    else
                    {
                        jQuery(".hideFull").hide();
                    }
                }
                window.onload = mainChanged;
                        </script>
<script>

function actionsChangedManual(ruleId, selectedValue)
{
    if (selectedValue==='run')
    {
        if(unsaved){
            alert("You have unsaved changes on this page. Please save your changes before manually running rules!");
            return;
        }
        runNowManual(ruleId);
    }
    else
    {
        if (selectedValue==='trash')
        {
            deletePostsManual(ruleId, 'trash');
        }
        else
        {
            deletePostsManual(ruleId, 'delete');
        }
    }
}
  </script>
  <script type="text/javascript">
		jQuery(document).ready(function() {
			jQuery('.newsomatic_image_button').click(function(){
				tb_show('',"media-upload.php?type=image&TB_iframe=true");
			});
		});
	</script>
  <style>
.mainselection select {
      font-size: 14px;
   border: 0;
   width:126px;
   color: #111;
   background: transparent;
   font-weight: bold;
   padding: 2px 10px;
   *background: #58B14C;
   -webkit-appearance: none;
}
.mainselection {
    width: 50%;
    margin: 0 auto;
   text-align:center;
   overflow:hidden;
   width:126px;
   -moz-border-radius: 9px 9px 9px 9px;
   -webkit-border-radius: 9px 9px 9px 9px;
   border-radius: 9px 9px 9px 9px;
   box-shadow: 1px 1px 11px #330033;
   background: #58B14C url("http://i62.tinypic.com/15xvbd5.png") no-repeat scroll 319px center;
}
.modal {
    display: none; /* Hidden by default */
    position: fixed; /* Stay in place */
    z-index: 1; /* Sit on top */
    padding-top: 40px; /* Location of the box */
    left: 0;
    top: 0;
    width: 100%; /* Full width */
    height: 100%; /* Full height */
    overflow: auto; /* Enable scroll if needed */
    background-color: rgb(0,0,0); /* Fallback color */
    background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
}
.modal-content {
    position: relative;
    background-color: #fefefe;
    margin: auto;
    padding: 0;
    border: 1px solid #888;
    width: 65%;
    box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2),0 6px 20px 0 rgba(0,0,0,0.19);
    -webkit-animation-name: animatetop;
    -webkit-animation-duration: 0.4s;
    animation-name: animatetop;
    animation-duration: 0.4s
}
@-webkit-keyframes animatetop {
    from {top:-300px; opacity:0} 
    to {top:0; opacity:1}
}
@keyframes animatetop {
    from {top:-300px; opacity:0}
    to {top:0; opacity:1}
}
.close {
    color: white;
    float: right;
    font-size: 28px;
    font-weight: bold;
}
.close:hover,
.close:focus {
    color: #000;
    text-decoration: none;
    cursor: pointer;
}
.ok {
    color: white;
    float: right;
    font-size: 28px;
    font-weight: bold;
}
.ok:hover,
.ok:focus {
    color: #000;
    text-decoration: none;
    cursor: pointer;
}
.modal-header {
    padding: 2px 16px;
    background-color: #5cb85c;
    color: white;
}
.modal-body {padding: 2px 16px;max-height:75vh;overflow:auto;}
.modal-footer {
    padding: 2px 16px;
    background-color: #5cb85c;
    color: white;
}
</style>
<?php
    if (isset($_GET['settings-updated'])) {
?>
<div>
<p style="border-bottom: 6px solid green;background-color: lightgrey;color:green;"><strong>Settings saved.</strong></p>
</div>
<?php
    }
?>
<div>
                    <div class="hideMain">
                    <hr/>              
        <div class="table-responsive">
                    <table class="responsive table" style="overflow-x:auto;width: 100%;">
				<thead>
					<tr>
                    <th>ID<div class="bws_help_box bws_help_box_right dashicons dashicons-editor-help" style="vertical-align: middle;">
                                        <div class="bws_hidden_help_text" style="min-width: 260px;">
<?php
    echo "This is the ID of the rule. ";
?>
                        </div>
                    </div></th>
						<th>Article Source<div class="bws_help_box bws_help_box_right dashicons dashicons-editor-help" style="vertical-align: middle;">
                                        <div class="bws_hidden_help_text" style="min-width: 260px;">
<?php
    echo "Select the source site of the article.";
?>
                        </div>
                    </div></th>
						<th>Schedule<div class="bws_help_box bws_help_box_right dashicons dashicons-editor-help" style="vertical-align: middle;">
                                        <div class="bws_hidden_help_text" style="min-width: 260px;">
<?php
    echo "Select the interval in hours after which you want this rule to run. Defined in hours.";
?>
                        </div>
                    </div></th>
                    <th>Max # Posts<div class="bws_help_box bws_help_box_right dashicons dashicons-editor-help" style="vertical-align: middle;">
                                        <div class="bws_hidden_help_text" style="min-width: 260px;">
<?php
    echo "Select the maximum number of posts that this rule can create at once. 0-20 interval allowed.";
?>
                        </div>
                    </div></th>
                    <th>Post Status<div class="bws_help_box bws_help_box_right dashicons dashicons-editor-help" style="vertical-align: middle;">
                                        <div class="bws_hidden_help_text" style="min-width: 260px;">
<?php
    echo "Select the status that you want for the automatically generated posts to have.";
?>
                        </div>
                    </div></th>
                    <th>Item Type<div class="bws_help_box bws_help_box_right dashicons dashicons-editor-help" style="vertical-align: middle;">
                                        <div class="bws_hidden_help_text" style="min-width: 260px;">
<?php
    echo "Select the type (post/page) for your automatically generated item.";
?>
                        </div>
                    </div></th>
                    <th>Post Author<div class="bws_help_box bws_help_box_right dashicons dashicons-editor-help" style="vertical-align: middle;">
                                        <div class="bws_hidden_help_text" style="min-width: 260px;">
<?php
    echo "Select the author that you want to assign for the automatically generated posts.";
?>
                        </div>
                    </div></th>
                    <th>More Options<div class="bws_help_box bws_help_box_right dashicons dashicons-editor-help" style="vertical-align: middle;">
                                        <div class="bws_hidden_help_text" style="min-width: 260px;">
<?php
    echo "Shows advanced settings for this rule.";
?>
                        </div>
                    </div></th>
                        <th style="max-width:20px;">Del<div class="bws_help_box bws_help_box_right dashicons dashicons-editor-help" style="vertical-align: middle;">
                                        <div class="bws_hidden_help_text" style="min-width: 260px;">
<?php
    echo "Do you want to delete this rule?";
?>
                        </div>
                    </div></th>
                        <th style="max-width:42px;" >Active<div class="bws_help_box bws_help_box_right dashicons dashicons-editor-help" style="vertical-align: middle;">
                                        <div class="bws_hidden_help_text" style="min-width: 260px;">
<?php
    echo "Do you want to enable this<br/> rule? You can deactivate<br/> any rule (you don't have<br/> to delete them to deactivate<br/> them).";
?>
                        </div>
                    </div></th>
                    <th style="max-width:32px;" >Info<div class="bws_help_box bws_help_box_right dashicons dashicons-editor-help" style="vertical-align: middle;">
                                        <div class="bws_hidden_help_text" style="min-width: 260px;">
<?php
    echo "The number of items (posts, pages) this rule has generated so far.";
?>
                        </div>
                    </div></th>
                    <th style="width:200px;min-width:160px;">Actions<div class="bws_help_box bws_help_box_right dashicons dashicons-editor-help" style="vertical-align: middle;">
                                        <div class="bws_hidden_help_text" style="min-width: 260px;">
<?php
    echo "Do you want to run this rule now? Note that only one instance of a rule is allowed at once.";
?>
                        </div>
                    </div></th>
					</tr>
                    <tr><td><hr/></td><td><hr/></td><td><hr/></td><td><hr/></td><td><hr/></td><td><hr/></td><td><hr/></td><td><hr/></td><td><hr/></td><td><hr/></td><td><hr/></td><td><hr/></td><td><hr/></td></tr>
				</thead>
				<tbody>
					<?php
    echo newsomatic_expand_rules_manual();
?>
                    <tr><td><hr/></td><td><hr/></td><td><hr/></td><td><hr/></td><td><hr/></td><td><hr/></td><td><hr/></td><td><hr/></td><td><hr/></td><td><hr/></td><td><hr/></td><td><hr/></td><td><hr/></td></tr>
					<tr>
                        <td style="max-width:32px;text-align:center;vertical-align: middle;">-</td>
                        <td style="min-width:70px;width:35%;"><select id="date" name="newsomatic_rules_list[date][]" style="width:100%;">
                                <option value="" disabled selected>Select an option</option>                 
<?php
$cats = newsomatic_get_categories();
if($cats !== false && isset($cats['category_list']) && is_array($cats['category_list']))
{
    foreach($cats['category_list'] as $key => $cat)
    {
        echo'<option value="' . $key . '">' . $cat . '</option>';
    }
}
?>           
</select></td>
<td style="width:60px;text-align:center;vertical-align: middle;"><input type="number" step="1" min="1" name="newsomatic_rules_list[schedule][]" style="width:60px;" placeholder="Select the rule schedule interval" value="24" style="width:100%;"/></td>
                        <td style="width:60px;text-align:center;vertical-align: middle;"><input type="number" step="1" min="0" max="20" name="newsomatic_rules_list[max][]" style="width:60px;" placeholder="Select the max # of generated posts" value="10" style="width:100%;"/></td>
                        <td style="max-width:70px;width:70px;text-align:center;vertical-align: middle;"><select id="submit_status" name="newsomatic_rules_list[submit_status][]" style="width:70px;">
                                  <option value="pending">Moderate -> Pending</option>
                                  <option value="draft">Moderate -> Draft</option>
                                  <option value="publish" selected>Published</option>
                                  <option value="private">Private</option>
                                  <option value="trash">Trash</option>
                    </select>  </td>
                    <td style="width:60px;text-align:center;vertical-align: middle;"><select id="default_type" name="newsomatic_rules_list[default_type][]" style="width:auto;">
<?php
$is_first = true;
foreach ( get_post_types( '', 'names' ) as $post_type ) {
   echo '<option value="' . $post_type . '"';
   if($is_first === true)
   {
       echo ' selected';
       $is_first = false;
   }
   echo '>' . $post_type . '</option>';
}
?>
                    </select>  </td>
                    <td style="width:100px;text-align:center;vertical-align: middle;"><select id="post_author" name="newsomatic_rules_list[post_author][]" style="width:auto;">
<?php
    $blogusers = get_users();
    foreach ($blogusers as $user) {
        echo '<option value="' . esc_html($user->ID) . '"';
        echo '>' . $user->display_name . '</option>';
    }
?>
                    </select>  </td>
                    <td style="width:70px;">
                    <input type="button" id="myBtn" value="Settings">
<div id="myModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <span id="newsomatic_close" class="close">&times;</span>
      <h2><span style="color:white">New Rule</span> Advanced Settings</h2>
    </div>
    <div class="modal-body">
    <div class="table-responsive">
    <table class="responsive table" style="width:100%;white-space:normal;">
    <tr><td style="min-width:200px;">
    <div>
        <div class="bws_help_box bws_help_box_right dashicons dashicons-editor-help" style="vertical-align: middle;">
                                        <div class="bws_hidden_help_text" style="min-width: 260px;">
<?php
    echo "Set the title of the generated posts for user rules. You can use the following shortcodes: %%random_sentence%%, %%random_sentence2%%, %%item_title%%, %%item_description%%, %%item_content%%, %%item_original_content%%, %%item_cat%%, %%item_tags%%";
?>
                        </div>
                    </div>
                    <b>Generated Post Title:</b>
                    
                    </td><td>
                    <input type="text" name="newsomatic_rules_list[post_title][]" value="%%item_title%%" placeholder="Please insert your desired post title. Example: %%item_title%%" style="width:100%">
                        
        </div>
        </td></tr><tr><td style="min-width:200px;">
        <div>
        <div class="bws_help_box bws_help_box_right dashicons dashicons-editor-help" style="vertical-align: middle;">
                                        <div class="bws_hidden_help_text" style="min-width: 260px;">
<?php
    echo "Set the content of the generated posts for user rules. You can use the following shortcodes: %%item_read_more_button%%, %%item_media%%, %%custom_html%%, %%custom_html2%%, %%random_sentence%%, %%random_sentence2%%, %%item_title%%, %%item_description%%, %%item_content%%, %%item_content_plain_text%%, %%item_img_url%%, %%item_url%%, %%item_cat%%, %%item_tags%%, %%item_show_image%%, %%item_image_URL%%, %%author%%, %%author_link%%";
?>
                        </div>
                    </div>
                    <b>Generated Post Content:</b>
                    
                    </td><td>
                    <textarea rows="2" cols="70" name="newsomatic_rules_list[post_content][]" placeholder="Please insert your desired post content. Example: %%item_media%%<br/>%%item_content%%<br/>%%item_read_more_button%%" style="width:100%">%%item_media%%<br/>%%item_content%%<br/>%%item_read_more_button%%</textarea>
                        
        </div>
        </td></tr><tr><td style="min-width:200px;">
        <div>
        <div class="bws_help_box bws_help_box_right dashicons dashicons-editor-help" style="vertical-align: middle;">
                                        <div class="bws_hidden_help_text" style="min-width: 260px;">
<?php
    echo "Select how you want to sort the resulting posts. Note that not all news sources support all kinds of sorting. In this cases they will fallback to 'No Sort' value.";
?>
                        </div>
                    </div>
                    <b>Sort Results By:</b>   
                    </td><td style="min-width:200px;">
                    <select id="sort" name="newsomatic_rules_list[sort][]" style="width:100%">
                    <option value="any" selected>No Sort</option>
                    <option value="top">Top Articles</option>
                    <option value="latest">Latest Articles</option>
                    <option value="popular">Popular Articles</option>
                </select>     
        </div>
        </td></tr><tr><td>
        <div>
        <div class="bws_help_box bws_help_box_right dashicons dashicons-editor-help" style="vertical-align: middle;">
                                        <div class="bws_hidden_help_text" style="min-width: 260px;">
<?php
    echo "Do you want to strip images from generated content?";
?>
                        </div>
                    </div>
                    <b>Strip Images From Content:</b>
                    
                    </td><td>
                    <input type="checkbox" id="strip_images" name="newsomatic_rules_list[strip_images][]">
                        
        </div>
        </td></tr><tr><td>
        <div>
        <div class="bws_help_box bws_help_box_right dashicons dashicons-editor-help" style="vertical-align: middle;">
                                        <div class="bws_hidden_help_text" style="min-width: 260px;">
<?php
    echo "Do you want to limit the title's lenght to a specific word count? To disable this feature, leave this field blank.";
?>
                        </div>
                    </div>
                    <b>Limit Title Word Count:</b>
                    
                    </td><td>
                    <input type="number" min="1" step="1" id="limit_title_word_count" name="newsomatic_rules_list[limit_title_word_count][]" value="" placeholder="Please insert a limit for title" style="width:100%;">
                        
        </div>
        </td></tr><tr><td>
        <div>
        <div class="bws_help_box bws_help_box_right dashicons dashicons-editor-help" style="vertical-align: middle;">
                                        <div class="bws_hidden_help_text" style="min-width: 260px;">
<?php
    echo "Do you want to disable post excerpt generation?";
?>
                        </div>
                    </div>
                    <b>Disable Post Excerpt:</b>
                    
                    </td><td>
                    <input type="checkbox" id="disable_excerpt" name="newsomatic_rules_list[disable_excerpt][]">   
        </div>
        </td></tr><tr><td style="min-width:200px;">
        <div>
        <div class="bws_help_box bws_help_box_right dashicons dashicons-editor-help" style="vertical-align: middle;">
                                        <div class="bws_hidden_help_text" style="min-width: 260px;">
<?php
    echo "If your template supports 'Post Formats', than you can select one here. If not, leave this at it's default value.";
?>
                        </div>
                    </div>
                    <b>Generated Post Format:</b>   
                    </td><td style="min-width:200px;">
                    <select id="post_format" name="newsomatic_rules_list[post_format][]" style="width:100%">
                    <option value="post-format-standard" selected>Standard</option>
                    <option value="post-format-aside">Aside</option>
                    <option value="post-format-gallery">Gallery</option>
                    <option value="post-format-link">Link</option>
                    <option value="post-format-image">Image</option>
                    <option value="post-format-quote">Quote</option>
                    <option value="post-format-status">Status</option>
                    <option value="post-format-video">Video</option>
                    <option value="post-format-audio">Audio</option>
                    <option value="post-format-chat">Chat</option>
                </select>     
        </div>
        </td></tr><tr><td style="min-width:200px;">
        <div>
        <div class="bws_help_box bws_help_box_right dashicons dashicons-editor-help" style="vertical-align: middle;">
                                        <div class="bws_hidden_help_text" style="min-width: 260px;">
<?php
    echo "Select the post category that you want for the automatically generated posts to have. To select more categories, hold down the CTRL key.";
?>
                        </div>
                    </div>
                    <b>Additional Post Category:</b>
                    
                    </td><td>
                    <select multiple id="default_category" name="newsomatic_rules_list[default_category][]" style="width:100%">
                    <option value="newsomatic_no_category_12345678" selected>Do Not Add a Category</option>
<?php
    $cat_args   = array(
        'orderby' => 'name',
        'hide_empty' => 0,
        'order' => 'ASC'
    );
    $categories = get_categories($cat_args);
    foreach ($categories as $category) {
?>
<option value="<?php
        echo $category->term_id;
?>"><?php
        echo sanitize_text_field($category->name);
?></option>
<?php
    }
?>
                </select>     
        </div>
        </td></tr><tr><td>
        <div>
        <div class="bws_help_box bws_help_box_right dashicons dashicons-editor-help" style="vertical-align: middle;">
                                        <div class="bws_hidden_help_text" style="min-width: 260px;">
<?php
    echo "Do you want to automatically add post categories from the News items?";
?>
                        </div>
                    </div>
                    <b>Auto Add Categories:</b>
                    
                    </td><td>
                    <select id="auto_categories" name="newsomatic_rules_list[auto_categories][]" style="width:100%">
                    <option value="disabled" selected>Disabled</option>
                    <option value="title">Title</option>                  
        </div>
        </td></tr><tr><td>
        <div>
        <div class="bws_help_box bws_help_box_right dashicons dashicons-editor-help" style="vertical-align: middle;">
                                        <div class="bws_hidden_help_text" style="min-width: 260px;">
<?php
    echo "This feature will try to remove the WordPress's default post category. This may fail in case no additional categories are added, because WordPress requires at least one post category for every post.";
?>
                        </div>
                    </div>
                    <b>Remove WP Default Post Category:</b>
                    
                    </td><td>
                    <input type="checkbox" id="remove_default" name="newsomatic_rules_list[remove_default][]">
                        
        </div>
        </td></tr><tr><td>
        <div>
        <div class="bws_help_box bws_help_box_right dashicons dashicons-editor-help" style="vertical-align: middle;">
                                        <div class="bws_hidden_help_text" style="min-width: 260px;">
<?php
    echo "Do you want to automatically add post tags from the News items?";
?>
                        </div>
                    </div>
                    <b>Auto Add Tags:</b>
                    
                    </td><td>
                    <select id="auto_tags" name="newsomatic_rules_list[auto_tags][]" style="width:100%">
                    <option value="disabled" selected>Disabled</option>
                    <option value="title">Title</option></select>                   
        </div>
        </td></tr><tr><td>
        <div>
        <div class="bws_help_box bws_help_box_right dashicons dashicons-editor-help" style="vertical-align: middle;">
                                        <div class="bws_hidden_help_text" style="min-width: 260px;">
<?php
    echo "Select the post tags that you want for the automatically generated posts to have.";
?>
                        </div>
                    </div>
                    <b>Additional Post Tags:</b>
                    
                    </td><td>
                    <input type="text" name="newsomatic_rules_list[default_tags][]" value="" placeholder="Please insert your additional post tags here" style="width:100%">
                        
        </div>
        </td></tr><tr><td>
        <div>
        <div class="bws_help_box bws_help_box_right dashicons dashicons-editor-help" style="vertical-align: middle;">
                                        <div class="bws_hidden_help_text" style="min-width: 260px;">
<?php
    echo "Do you want to enable comments for the generated posts?";
?>
                        </div>
                    </div>
                    <b>Enable Comments For Posts:</b>
                    
                    </td><td>
                    <input type="checkbox" id="enable_comments" name="newsomatic_rules_list[enable_comments][]" checked>
                        
        </div>
        </td></tr><tr><td>
        <div>
        <div class="bws_help_box bws_help_box_right dashicons dashicons-editor-help" style="vertical-align: middle;">
                                        <div class="bws_hidden_help_text" style="min-width: 260px;">
<?php
    echo "Do you want to enable pingbacks/trackbacks for the generated posts?";
?>
                        </div>
                    </div>
                    <b>Enable Pingback/Trackback:</b>
                    
                    </td><td>
                    <input type="checkbox" id="enable_pingback" name="newsomatic_rules_list[enable_pingback][]" checked>
                        
        </div>
        </td></tr><tr><td>
        <div>
        <div class="bws_help_box bws_help_box_right dashicons dashicons-editor-help" style="vertical-align: middle;">
                                        <div class="bws_hidden_help_text" style="min-width: 260px;">
<?php
    echo "Do you want to set featured image for generated post (to the first image that was found in the post)? If you don't check the 'Get Image From Pixabay' checkbox, this will work only when 'Get Full Content' is also checked.";
?>
                        </div>
                    </div>
                    <b>Auto Get Featured Image:</b>
                    
                    </td><td>
                    <input type="checkbox" id="featured_image" name="newsomatic_rules_list[featured_image][]" checked>
                        
        </div>
        </td></tr><tr><td>
        <div class="bws_help_box bws_help_box_right dashicons dashicons-editor-help" style="vertical-align: middle;">
                                        <div class="bws_hidden_help_text" style="min-width: 260px;">
<?php
    echo "Insert a link to a valid image that will be set for the featured image for the posts that do not have a valid image attached or if you disabled automatical featured image generation. To disable this feature, leave this field blank.";
?>
                        </div>
                    </div>
                    <b>Default Featured Image:</b>
                    </td><td>
                    <input style="width:60%;" type="url" validator="url" name="newsomatic_rules_list[image_url][]" placeholder="Please insert the link to a valid image" value=""/>
                    <input style="width:33%" class="newsomatic_image_button" type="button" value="Choose image"/>
        </td></tr><tr><td>
        <div>
        <div class="bws_help_box bws_help_box_right dashicons dashicons-editor-help" style="vertical-align: middle;">
                                        <div class="bws_hidden_help_text" style="min-width: 260px;">Do you want to try to get full article content from the linked URL? This will replace the content of the %%item_content%% shortcode.
                        </div>
                    </div>
                    <b>Try to Get Full Article Content:</b>
                    
                    </td><td>
                    <input type="checkbox" id="full_content" name="newsomatic_rules_list[full_content][]" onchange="mainChanged()">               
        </div>
        </td></tr><tr><td>
        <div class="hideFull">
        <div class="bws_help_box bws_help_box_right dashicons dashicons-editor-help" style="vertical-align: middle;">
                                        <div class="bws_hidden_help_text" style="min-width: 260px;">Select the query type you want to search for the article full content. XPath: <a href='https://www.w3schools.com/xml/xpath_intro.asp' target='_blank'>More info/tutorial</a>.
                        </div>
                    </div>
                    <b>Full Content Query Type:</b>
                    </div>
                    </td><td>
                    <div class="hideFull">
                    <select id="type" name="newsomatic_rules_list[type][]" style="width:100%">
                    <option value="id" selected>ID</option>
                    <option value="class">Class</option>
                    <option value="xpath">XPath</option>
                </select>              
        </div>
        </td></tr><tr><td>
        <div class="hideFull">
        <div class="bws_help_box bws_help_box_right dashicons dashicons-editor-help" style="vertical-align: middle;">
                                        <div class="bws_hidden_help_text" style="min-width: 260px;">
<?php
    echo "Input the search query for full content searching. This can be the ID or class name you want to search, the <a href='https://regexone.com/' target='_blank'>regex expression</a> you want to apply for or the XPath Expression you want to query for. <a href='https://www.w3schools.com/xml/xpath_intro.asp' target='_blank'>More info/tutorial</a>.";
?>
                        </div>
                    </div>
                    <b>Search Query String:</b>
                    </div>
                    </td><td>
                    <div class="hideFull">
                    <input type="text" name="newsomatic_rules_list[expre][]" value="" placeholder="Please insert your query" style="width:100%">
                        
        </div>
        </td></tr><tr><td>
        <div class="hideFull">
        <div class="bws_help_box bws_help_box_right dashicons dashicons-editor-help" style="vertical-align: middle;">
                                        <div class="bws_hidden_help_text" style="min-width: 260px;">
<?php
    echo "Select a percentage of the grabbed content that will be included in the article. This is useful when the author states that you can legally get up to 25% of the full article. To disable this feature, leave this field blank.";
?>
                        </div>
                    </div>
                    <b>Percentage Of The Full Content To Keep:</b>
                    </div>
                    </td><td>
                    <div class="hideFull">
                    <input type="number" min="1" step="1" max="100" name="newsomatic_rules_list[content_percent][]" value="" placeholder="Please insert a percentage" style="width:100%">
                        
        </div>
        </td></tr><tr><td>
        <div class="hideFull">
        <div class="bws_help_box bws_help_box_right dashicons dashicons-editor-help" style="vertical-align: middle;">
                                        <div class="bws_hidden_help_text" style="min-width: 260px;">Do you want to strip HTML from Full Article Content?
                        </div>
                    </div>
                    <b>Strip HTML From Full Content:</b>
                    </div>
                    </td><td>
                    <div class="hideFull">
                    <input type="checkbox" id="only_text" name="newsomatic_rules_list[only_text][]">               
        </div>
        </td></tr><tr><td>
        <div class="hideFull">
        <div class="bws_help_box bws_help_box_right dashicons dashicons-editor-help" style="vertical-align: middle;">
                                        <div class="bws_hidden_help_text" style="min-width: 260px;">Do you want to get only one element or all elements that fit the defined rule?
                        </div>
                    </div>
                    <b>Get Only The First Found Element:</b>
                    </div>
                    </td><td>
                    <div class="hideFull">
                    <input type="checkbox" id="single" name="newsomatic_rules_list[single][]">               
        </div>
        </td></tr><tr><td>
        <div class="hideFull">
        <div class="bws_help_box bws_help_box_right dashicons dashicons-editor-help" style="vertical-align: middle;">
                                        <div class="bws_hidden_help_text" style="min-width: 260px;">Do you want to get only the inner content of the div or the full div (with tags you searched for)?
                        </div>
                    </div>
                    <b>Get Only The Inner Div Content:</b>
                    </div>
                    </td><td>
                    <div class="hideFull">
                    <input type="checkbox" id="inner" name="newsomatic_rules_list[inner][]">               
        </div>
        </td></tr><tr><td>
        <div class="hideFull">
        <div class="bws_help_box bws_help_box_right dashicons dashicons-editor-help" style="vertical-align: middle;">
                                        <div class="bws_hidden_help_text" style="min-width: 260px;">Do you want to also get any CSS file content that was included in the scaped URL?
                        </div>
                    </div>
                    <b>Also Get Found CSS Files Content:</b>
                    </div>
                    </td><td>
                    <div class="hideFull">
                    <input type="checkbox" id="get_css" name="newsomatic_rules_list[get_css][]">               
        </div>
        </td></tr><tr><td>
        <div class="hideFull">
        <div class="bws_help_box bws_help_box_right dashicons dashicons-editor-help" style="vertical-align: middle;">
                                        <div class="bws_hidden_help_text" style="min-width: 260px;">Select the source page encoding
                        </div>
                    </div>
                    <b>Source Article Encoding:</b>
                    </div>
                    </td><td>
                    <div class="hideFull">
                    <select id="encoding" name="newsomatic_rules_list[encoding][]" style="width:100%">
                    <option value="NO_CHANGE">Feature Disabled</option>
                    <option value="AUTO">Auto Detect</option>
<?php
    $i=0;
	foreach($GLOBALS['encodings'] as $enc){
        echo '<option value="' . $GLOBALS['encodings'][$i] . '"'; 
        echo '>' . $GLOBALS['encodings'][$i] . '</option>';
        $i++;
    }
?>
            </select>          
        </div>
        </td></tr></table></div>
    </div>
    <div class="modal-footer">
      <br/>
      <h3 style="display:inline">Newsomatic Automatic Post Generator</h3><span style="display:inline" id="newsomatic_ok" class="ok">OK&nbsp;</span>
      <br/><br/>
    </div>
  </div>
</div>
<script>
var modal = document.getElementById('myModal');
var btn = document.getElementById("myBtn");
var span = document.getElementById("newsomatic_close");
var ok = document.getElementById("newsomatic_ok");
btn.onclick = function() {
    modal.style.display = "block";
}
span.onclick = function() {
    modal.style.display = "none";
}
ok.onclick = function() {
    modal.style.display = "none";
}
window.onclick = function(event) {
    if (event.target == modal) {
        modal.style.display = "none";
    }
}
</script>   
    
                    </td>
						<td style="max-width:20px;text-align: center;" ><span style="max-width:20px;color:gray;" >X</span></td>
                        <td style="max-width:32px;text-align:center;vertical-align: middle;"><input type="checkbox" name="newsomatic_rules_list[active][]" value="1" checked />
                        <input type="hidden" name="newsomatic_rules_list[last_run][]" value="1988-01-27 00:00:00"/></td>
                        <td style="max-width:32px;text-align:center;vertical-align: middle;"><div class="bws_help_box bws_help_box_right dashicons dashicons-editor-help" style="vertical-align: middle;">
                                        <div class="bws_hidden_help_text" style="min-width: 260px;">
<?php
    echo "No info.";
?>
                        </div>
                    </div></td>
                        <td style="text-align: center;">
                        <div>
                        <img src="<?php
    echo plugin_dir_url(dirname(__FILE__)) . 'images/running.gif';
?>" alt="Running" style="float: left;visibility:hidden">
                        <div class="mainselection" style="background-color:gray;">
                        <select id="actions" class="actions" name="actions" disabled>
                            <option value="select" disabled selected>Select an Action</option>
                            <option value="run" onclick="">Run This Rule Now</option>
                            <option value="trash" onclick="">Move All Posts To Trash</option>
                            <option value="delete" onclick="">Permanently Delete All Posts</option>
                        </select>
                        </div>
                        </div>
                        </td>
					</tr>
				</tbody>
			</table>
            </div>
        
        </div>
        </div>
        <hr/> 
<div><p class="submit"><input type="submit" name="btnSubmit" id="btnSubmit" class="button button-primary" onclick="unsaved = false;" value="Save Settings"/></p></div>
    </form>
</div>
</div>
<script>
jQuery("#myForm").submit(function () {

                    var this_master = jQuery(this);
jQuery('button[type=submit], input[type=submit]').prop('disabled',true);
                    this_master.find('input[type="checkbox"]').each( function () {
                        var checkbox_this = jQuery(this);

                        if (checkbox_this.attr("id") !== "exclusion")
                        {
                            if( checkbox_this.is(":checked") == true ) {
                                checkbox_this.attr('value','1');
                            } else {
                                checkbox_this.prop('checked',true);  
                                checkbox_this.attr('value','0');
                            }
                        }
                    })
                })
                </script>
<?php
}
if (isset($_POST['newsomatic_rules_list'])) {
    add_action('admin_init', 'newsomatic_save_rules_manual');
}

function newsomatic_save_rules_manual($data2)
{
    check_admin_referer('newsomatic_save_rules', '_newsomaticr_nonce');
    
    $data2 = $_POST['newsomatic_rules_list'];
    $rules = array();
    $cont  = 0;
    $cat_cont = 0;
    if (isset($data2['date'][0])) {
        for ($i = 0; $i < sizeof($data2['date']); ++$i) {
            $bundle = array();
            if (isset($data2['schedule'][$i]) && $data2['schedule'][$i] != '' && $data2['date'][$i] != '') {
                $bundle[] = trim(sanitize_text_field($data2['limit_title_word_count'][$i]));
                $bundle[] = trim(sanitize_text_field($data2['schedule'][$i]));
                if (isset($data2['active'][$i])) {
                    $bundle[] = trim(sanitize_text_field($data2['active'][$i]));
                } else {
                    $bundle[] = '0';
                }
                $bundle[]     = trim(sanitize_text_field($data2['last_run'][$i]));
                $bundle[]     = trim(sanitize_text_field($data2['submit_status'][$i]));
                $bundle[]     = trim(sanitize_text_field($data2['default_type'][$i]));
                $bundle[]     = trim(sanitize_text_field($data2['post_author'][$i]));
                $bundle[]     = trim(sanitize_text_field($data2['default_tags'][$i]));
                if($i == sizeof($data2['schedule']) - 1)
                {
                    $bundle[]     = $data2['default_category'];
                }
                else
                {
                    if(!isset($data2['default_category' . $cat_cont]))
                    {
                        $cat_cont++;
                    }
                    $bundle[]     = $data2['default_category' . $cat_cont];
                }
                $bundle[]     = trim(sanitize_text_field($data2['auto_categories'][$i]));
                $bundle[]     = trim(sanitize_text_field($data2['auto_tags'][$i]));
                $bundle[]     = trim(sanitize_text_field($data2['enable_comments'][$i]));
                $bundle[]     = trim(sanitize_text_field($data2['featured_image'][$i]));
                $bundle[]     = trim(sanitize_text_field($data2['image_url'][$i]));
                $bundle[]     = $data2['post_title'][$i];
                $bundle[]     = $data2['post_content'][$i];
                $bundle[]     = trim(sanitize_text_field($data2['enable_pingback'][$i]));
                $bundle[]     = trim(sanitize_text_field($data2['post_format'][$i]));
                $bundle[]     = trim(sanitize_text_field($data2['date'][$i]));
                $bundle[]     = trim(sanitize_text_field($data2['strip_images'][$i]));
                $bundle[]     = trim(sanitize_text_field($data2['sort'][$i]));
                $bundle[]     = trim(sanitize_text_field($data2['max'][$i]));
                $bundle[]     = trim(sanitize_text_field($data2['full_content'][$i]));
                $bundle[]     = trim(sanitize_text_field($data2['only_text'][$i]));
                $bundle[]     = trim(sanitize_text_field($data2['single'][$i]));
                $bundle[]     = trim(sanitize_text_field($data2['type'][$i]));
                $bundle[]     = trim(sanitize_text_field($data2['inner'][$i]));
                $bundle[]     = $data2['expre'][$i];
                $bundle[]     = trim(sanitize_text_field($data2['get_css'][$i]));
                $bundle[]     = trim(sanitize_text_field($data2['encoding'][$i]));
                $bundle[]     = trim(sanitize_text_field($data2['disable_excerpt'][$i]));
                $bundle[]     = trim(sanitize_text_field($data2['content_percent'][$i]));
                $bundle[]     = trim(sanitize_text_field($data2['remove_default'][$i]));
                $rules[$cont] = $bundle;
                $cont++;
                $cat_cont++;
            }
        }
    }
    update_option('newsomatic_rules_list', $rules);
}
function newsomatic_expand_rules_manual()
{
    if (!get_option('newsomatic_running_list')) {
        $running = array();
    } else {
        $running = get_option('newsomatic_running_list');
    }
    $rules  = get_option('newsomatic_rules_list');
    $output = '';
    $cont   = 0;
    if (!empty($rules)) {
        $posted_items = array();
        $query        = array(
            'post_status' => array(
                'publish',
                'draft',
                'pending',
                'trash',
                'private'
            ),
            'post_type' => array(
                'any'
            ),
            'numberposts' => -1,
            'fields' => 'ids'
        );
        $post_list    = get_posts($query);
        wp_suspend_cache_addition(true);
        foreach ($post_list as $post) {
            $rule_id = get_post_meta($post, 'newsomatic_parent_rule', true);
            $exp = explode('-', $rule_id);
            if(isset($exp[0]) && isset($exp[1]) && $exp[0] == '0')
            {
                $posted_items[] = $exp[1];
            }
        }
        wp_suspend_cache_addition(false);
        $counted_vals = array_count_values($posted_items);
        foreach ($rules as $request => $bundle[]) {
            if (isset($counted_vals[$cont])) {
                $generated_posts = $counted_vals[$cont];
            } else {
                $generated_posts = 0;
            }
            $bundle_values          = array_values($bundle);
            $myValues               = $bundle_values[$cont];
            $array_my_values        = array_values($myValues);
            $limit_title_word_count             = $array_my_values[0];
            $schedule               = $array_my_values[1];
            $active                 = $array_my_values[2];
            $last_run               = $array_my_values[3];
            $status                 = $array_my_values[4];
            $def_type               = $array_my_values[5];
            $post_user_name         = $array_my_values[6];
            $default_tags           = $array_my_values[7];
            $default_category       = $array_my_values[8];
            $auto_categories        = $array_my_values[9];
            $auto_tags              = $array_my_values[10];
            $enable_comments        = $array_my_values[11];
            $featured_image         = $array_my_values[12];
            $image_url              = $array_my_values[13];
            $post_title             = $array_my_values[14];
            $post_content           = $array_my_values[15];
            $enable_pingback        = $array_my_values[16];
            $post_format            = $array_my_values[17];
            $date                   = $array_my_values[18];
            $strip_images           = $array_my_values[19];
            $sort                   = $array_my_values[20];
            $max                    = $array_my_values[21];
            $full_content           = $array_my_values[22];
            $only_text              = $array_my_values[23];
            $single                 = $array_my_values[24];
            $type                   = $array_my_values[25];
            $inner                  = $array_my_values[26];
            $expre                  = $array_my_values[27];
            $get_css                = $array_my_values[28];
            $encoding               = $array_my_values[29];
            $disable_excerpt        = $array_my_values[30];
            $content_percent        = $array_my_values[31];
            $remove_default         = $array_my_values[32];
            $output .= '<tr>
                        <td style="max-width:32px;text-align:center;vertical-align: middle;">' . $cont . '</td>
                        <td style="min-width:70px;width:35%;"><select id="date" name="newsomatic_rules_list[date][]" style="width:100%;">';
$cats = newsomatic_get_categories();
if($cats !== false && isset($cats['category_list']) && is_array($cats['category_list']))
{
    foreach($cats['category_list'] as $key => $cat)
    {
        $output .= '<option value="' . $key . '"';
        if($date == $key)
        {
            $output .= ' selected';
        }
        $output .= '>' . $cat . '</option>';
    }
}
$output .= '</select></td>
						<td style="width:60px;text-align:center;vertical-align: middle;"><input type="number" step="1" min="1" placeholder="# h" name="newsomatic_rules_list[schedule][]" style="width:60px;" value="' . $schedule . '" style="width:100%;" required></td>
                        <td style="width:60px;text-align:center;vertical-align: middle;"><input type="number" step="1" min="0" placeholder="# max" max="20" name="newsomatic_rules_list[max][]" style="width:60px;" value="' . $max . '" style="width:100%;" required></td>
                        <td style="max-width:70px;width:70px;text-align:center;vertical-align: middle;"><select id="submit_status" name="newsomatic_rules_list[submit_status][]" style="width:70px;">
                                  <option value="pending"';
            if ($status == 'pending') {
                $output .= ' selected';
            }
            $output .= '>Moderate -> Pending</option>
                                  <option value="draft"';
            if ($status == 'draft') {
                $output .= ' selected';
            }
            $output .= '>Moderate -> Draft</option>
                                  <option value="publish"';
            if ($status == 'publish') {
                $output .= ' selected';
            }
            $output .= '>Published</option>
                                  <option value="private"';
            if ($status == 'private') {
                $output .= ' selected';
            }
            $output .= '>Private</option>
                                  <option value="trash"';
            if ($status == 'trash') {
                $output .= ' selected';
            }
            $output .= '>Trash</option>
                    </select>  </td>
                    <td style="width:60px;text-align:center;vertical-align: middle;"><select id="default_type" name="newsomatic_rules_list[default_type][]" style="width:auto;">';
            foreach ( get_post_types( '', 'names' ) as $post_type ) {
               $output .= '<option value="' . $post_type . '"';
               if ($def_type == $post_type) {
                    $output .= ' selected';
                }
               $output .= '>' . $post_type . '</option>';
            }
            $output .= '</select>  </td>
                    <td style="width:100px;text-align:center;vertical-align: middle;"><select id="post_author" name="newsomatic_rules_list[post_author][]" style="width:auto;">';
            $blogusers = get_users();
            foreach ($blogusers as $user) {
                $output .= '<option value="' . esc_html($user->ID) . '"';
                if ($post_user_name == $user->ID) {
                    $output .= " selected";
                }
                $output .= '>' . $user->display_name . '</option>';
            }
            $output .= '</select>  </td>
                    <td style="width:70px;">
                    <input type="button" id="myBtn' . $cont . '" value="Settings">
                    <div id="myModal' . $cont . '" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <span id="newsomatic_close' . $cont . '" class="close">&times;</span>
      <h2>Rule <span style="color:white">ID ' . $cont . '</span> Advanced Settings</h2>
    </div>
    <div class="modal-body">
    <div class="table-responsive">
      <table class="responsive table" style="width:100%;white-space:normal;">
    <tr><td style="min-width:200px;">
    <div>
        <div class="bws_help_box bws_help_box_right dashicons dashicons-editor-help" style="vertical-align: middle;">
                                        <div class="bws_hidden_help_text" style="min-width: 260px;">Set the title of the generated posts for user rules. You can use the following shortcodes:  %%random_sentence%%, %%random_sentence2%%, %%item_title%%, %%item_description%%, %%item_content%%, %%item_cat%%, %%item_tags%%, %%item_show_image%%, %%item_image_URL%%, %%author%%, %%author_link%%
                        </div>
                    </div>
                    <b>Generated Post Title:</b>
                    
                    </td><td>
                    <input type="text" name="newsomatic_rules_list[post_title][]" value="' . stripcslashes(htmlspecialchars($post_title)) . '" placeholder="Please insert your desired post title. Example: %%item_title%%" style="width:100%">
                        
        </div>
        </td></tr><tr><td style="min-width:200px;">
        <div>
        <div class="bws_help_box bws_help_box_right dashicons dashicons-editor-help" style="vertical-align: middle;">
                                        <div class="bws_hidden_help_text" style="min-width: 260px;">Set the content of the generated posts for user rules. You can use the following shortcodes: %%item_read_more_button%%, %%item_media%%, %%custom_html%%, %%custom_html2%%, %%random_sentence%%, %%random_sentence2%%, %%item_title%%, %%item_description%%, %%item_content%%, %%item_original_content%%, %%item_content_plain_text%%, %%item_img_url%%, %%item_url%%, %%item_cat%%, %%item_tags%%
                        </div>
                    </div>
                    <b>Generated Post Content:</b>
                    
                    </td><td>
                    <textarea rows="2" cols="70" name="newsomatic_rules_list[post_content][]" placeholder="Please insert your desired post content. Example:%%item_content%%" style="width:100%">' . stripcslashes(htmlspecialchars($post_content)) . '</textarea>
                        
        </div>
        </td></tr><tr><td style="min-width:200px;">
        <div>
        <div class="bws_help_box bws_help_box_right dashicons dashicons-editor-help" style="vertical-align: middle;">
                                        <div class="bws_hidden_help_text" style="min-width: 260px;">Select how you want to sort the resulting posts. Note that not all news sources support all kinds of sorting. In this cases they will fallback to \'No Sort\' value.
                        </div>
                    </div>
                    <b>Sort Results By:</b>   
                    </td><td style="min-width:200px;">
                    <select id="sort" name="newsomatic_rules_list[sort][]" style="width:100%">
                    <option value="any"';
            if ($sort == 'any') {
                $output .= ' selected';
            }
            $output .= '>No Sort</option>
                    <option value="top"';
            if ($sort == 'top') {
                $output .= ' selected';
            }
            $output .= '>Top Articles</option>
                    <option value="latest"';
            if ($sort == 'latest') {
                $output .= ' selected';
            }
            $output .= '>Latest Articles</option>
                    <option value="popular"';
            if ($sort == 'popular') {
                $output .= ' selected';
            }
            $output .= '>Popular Articles</option>
                </select>     
        </div>
        </td></tr><tr><td>
        <div>
        <div class="bws_help_box bws_help_box_right dashicons dashicons-editor-help" style="vertical-align: middle;">
                                        <div class="bws_hidden_help_text" style="min-width: 260px;">Do you want to strip images from generated content?
                        </div>
                    </div>
                    <b>Strip Images From Content:</b>
                    
                    </td><td>
                    <input type="checkbox" id="strip_images" name="newsomatic_rules_list[strip_images][]"';
            if ($strip_images == '1') {
                $output .= ' checked';
            }
            $output .= '>
                        
        </div>
        </td></tr><tr><td>
        <div>
        <div class="bws_help_box bws_help_box_right dashicons dashicons-editor-help" style="vertical-align: middle;">
                                        <div class="bws_hidden_help_text" style="min-width: 260px;">Do you want to limit the title\'s lenght to a specific word count? To disable this feature, leave this field blank.
                        </div>
                    </div>
                    <b>Limit Title Word Count:</b>
                    
                    </td><td>
                    <input type="number" min="1" step="1" id="limit_title_word_count" name="newsomatic_rules_list[limit_title_word_count][]" value="' . $limit_title_word_count . '" placeholder="Please insert a title limit count" style="width:100%;">
                        
        </div>
        </td></tr><tr><td>
        <div>
        <div class="bws_help_box bws_help_box_right dashicons dashicons-editor-help" style="vertical-align: middle;">
                                        <div class="bws_hidden_help_text" style="min-width: 260px;">Do you want to disable post excerpt generation?
                        </div>
                    </div>
                    <b>Disable Post Excerpt:</b>
                    
                    </td><td>
                    <input type="checkbox" id="disable_excerpt" name="newsomatic_rules_list[disable_excerpt][]"';
            if ($disable_excerpt == '1') {
                $output .= ' checked';
            }
            $output .= '>   
        </div>
        </td></tr><tr><td style="min-width:200px;">
        <div>
        <div class="bws_help_box bws_help_box_right dashicons dashicons-editor-help" style="vertical-align: middle;">
                                        <div class="bws_hidden_help_text" style="min-width: 260px;">If your template supports "Post Formats", than you can select one here. If not, leave this at it\'s default value.
                        </div>
                    </div>
                    <b>Generated Post Format:</b>   
                    </td><td>
                    <select id="post_format" name="newsomatic_rules_list[post_format][]" style="width:100%">
                    <option value="post-format-standard"';
            if ($post_format == 'post-format-standard') {
                $output .= ' selected';
            }
            $output .= '>Standard</option>
                    <option value="post-format-aside"';
            if ($post_format == 'post-format-aside') {
                $output .= ' selected';
            }
            $output .= '>Aside</option>
                    <option value="post-format-gallery"';
            if ($post_format == 'post-format-gallery') {
                $output .= ' selected';
            }
            $output .= '>Gallery</option>
                    <option value="post-format-link"';
            if ($post_format == 'post-format-link') {
                $output .= ' selected';
            }
            $output .= '>Link</option>
                    <option value="post-format-image"';
            if ($post_format == 'post-format-image') {
                $output .= ' selected';
            }
            $output .= '>Image</option>
                    <option value="post-format-quote"';
            if ($post_format == 'post-format-quote') {
                $output .= ' selected';
            }
            $output .= '>Quote</option>
                    <option value="post-format-status"';
            if ($post_format == 'post-format-status') {
                $output .= ' selected';
            }
            $output .= '>Status</option>
                    <option value="post-format-video"';
            if ($post_format == 'post-format-video') {
                $output .= ' selected';
            }
            $output .= '>Video</option>
                    <option value="post-format-audio"';
            if ($post_format == 'post-format-audio') {
                $output .= ' selected';
            }
            $output .= '>Audio</option>
                    <option value="post-format-chat"';
            if ($post_format == 'post-format-chat') {
                $output .= ' selected';
            }
            $output .= '>Chat</option>
                </select>     
        </div>
        </td></tr><tr><td style="min-width:200px;">
        <div>
        <div class="bws_help_box bws_help_box_right dashicons dashicons-editor-help" style="vertical-align: middle;">
                                        <div class="bws_hidden_help_text" style="min-width: 260px;">Select the post category that you want for the automatically generated posts to have. To select more categories, hold down the CTRL key.
                        </div>
                    </div>
                    <b>Additional Post Category:</b>
                    
                    </td><td>
                    <select multiple style="width:100%" id="default_category" name="newsomatic_rules_list[default_category' . $cont . '][]">
                    <option value="newsomatic_no_category_12345678"';
                    if(!is_array($default_category))
                    {
                        $default_category = array();
                    }
                    foreach($default_category as $dc)
                    {
                        if ("newsomatic_no_category_12345678" == $dc) {
                            $output .= ' selected';
                        }
                    }
                    $output .= '>Do Not Add a Category</option>';
            $cat_args   = array(
                "orderby" => "name",
                "hide_empty" => 0,
                "order" => "ASC"
            );
            $categories = get_categories($cat_args);
            
            foreach ($categories as $category) {
                $output .= '<option value="' . $category->term_id . '"';
                foreach($default_category as $dc)
                {
                    if ($category->term_id == $dc) {
                        $output .= ' selected';
                    }
                }
                
                $output .= '>' . sanitize_text_field($category->name) . '</option>';
            }
            $output .= '</select>     
        </div>
        </td></tr><tr><td>
        <div>
        <div class="bws_help_box bws_help_box_right dashicons dashicons-editor-help" style="vertical-align: middle;">
                                        <div class="bws_hidden_help_text" style="min-width: 260px;">Do you want to automatically add post categories, from the feed items?
                        </div>
                    </div>
                    <b>Auto Add Categories:</b>
                    
                    </td><td> 
                    <select id="auto_categories" name="newsomatic_rules_list[auto_categories][]" style="width:100%">
                    <option value="disabled"';
            if ($auto_categories == 'disabled') {
                $output .= ' selected';
            }
            $output .= '>Disabled</option>
            <option value="title"';
            if ($auto_categories == 'title') {
                $output .= ' selected';
            }
            $output .= '>Title</option></select>              
        </div>
        </td></tr><tr><td>
        <div>
        <div class="bws_help_box bws_help_box_right dashicons dashicons-editor-help" style="vertical-align: middle;">
                                        <div class="bws_hidden_help_text" style="min-width: 260px;">This feature will try to remove the WordPress\'s default post category. This may fail in case no additional categories are added, because WordPress requires at least one post category for every post.
                        </div>
                    </div>
                    <b>Remove WP Default Post Category:</b>
                    
                    </td><td>
                    <input type="checkbox" id="remove_default" name="newsomatic_rules_list[remove_default][]"';
        if($remove_default == '1')
        {
            $output .= ' checked';
        }
        $output .= '>
                        
        </div>
        </td></tr><tr><td>
        <div>
        <div class="bws_help_box bws_help_box_right dashicons dashicons-editor-help" style="vertical-align: middle;">
                                        <div class="bws_hidden_help_text" style="min-width: 260px;">Do you want to automatically add post tags from the feed items?
                        </div>
                    </div>
                    <b>Auto Add Tags:</b>
                    
                    </td><td>
                    <select id="auto_tags" name="newsomatic_rules_list[auto_tags][]" style="width:100%">
                    <option value="disabled"';
            if ($auto_tags == 'disabled') {
                $output .= ' selected';
            }
            $output .= '>Disabled</option>
                    <option value="title"';
            if ($auto_tags == 'title') {
                $output .= ' selected';
            }
            $output .= '>Title</option>';
            $output .= '</select>        
        </div>
        </td></tr><tr><td>
        <div>
        <div class="bws_help_box bws_help_box_right dashicons dashicons-editor-help" style="vertical-align: middle;">
                                        <div class="bws_hidden_help_text" style="min-width: 260px;">Select the post tags that you want for the automatically generated posts to have.
                        </div>
                    </div>
                    <b>Additional Post Tags:</b>
                    
                    </td><td>
                    <input style="width:100%" type="text" name="newsomatic_rules_list[default_tags][]" value="' . $default_tags . '" placeholder="Please insert your additional post tags here" >
                        
        </div>
        </td></tr><tr><td>
        <div>
        <div class="bws_help_box bws_help_box_right dashicons dashicons-editor-help" style="vertical-align: middle;">
                                        <div class="bws_hidden_help_text" style="min-width: 260px;">Do you want to enable comments for the generated posts?
                        </div>
                    </div>
                    <b>Enable Comments For Posts:</b>
                    
                    </td><td>
                    <input type="checkbox" id="enable_comments" name="newsomatic_rules_list[enable_comments][]"';
            if ($enable_comments == '1') {
                $output .= ' checked';
            }
            $output .= '>
                        
        </div>
        </td></tr><tr><td>
        <div>
        <div class="bws_help_box bws_help_box_right dashicons dashicons-editor-help" style="vertical-align: middle;">
                                        <div class="bws_hidden_help_text" style="min-width: 260px;">Do you want to enable pingbacks and trackbacks for the generated posts?
                        </div>
                    </div>
                    <b>Enable Pingback/Trackback:</b>
                    
                    </td><td>
                    <input type="checkbox" id="enable_pingback" name="newsomatic_rules_list[enable_pingback][]"';
            if ($enable_pingback == '1') {
                $output .= ' checked';
            }
            $output .= '>
                        
        </div>
        </td></tr><tr><td>
        <div>
        <div class="bws_help_box bws_help_box_right dashicons dashicons-editor-help" style="vertical-align: middle;">
                                        <div class="bws_hidden_help_text" style="min-width: 260px;">Do you want to set featured image for generated post (to the first image that was found in the post)? This works only when \'Get Full Content\' is also checked.
                        </div>
                    </div>
                    <b>Auto Get Featured Image:</b>
                    
                    </td><td>
                    <input type="checkbox" id="featured_image" name="newsomatic_rules_list[featured_image][]"';
            if ($featured_image == '1') {
                $output .= ' checked';
            }
            $output .= '>
                        
        </div>
        </td></tr><tr><td>
        <div class="bws_help_box bws_help_box_right dashicons dashicons-editor-help" style="vertical-align: middle;">
                                        <div class="bws_hidden_help_text" style="min-width: 260px;">Insert a link to a valid image that will be set for the featured image for the posts that do not have a valid image attached or if you disabled automatical featured image generation. To disable this feature, leave this field blank.
                        </div>
                    </div>
                    <b>Default Featured Image:</b>
                    </td><td>
                    <input style="width:60%;" type="url" validator="url" name="newsomatic_rules_list[image_url][]" placeholder="Please insert the link to a valid image" value="' . $image_url . '"/>
                    <input style="width:33%;" class="newsomatic_image_button" type="button" value="Choose image"/>
        </td></tr><tr><td>
        <div>
        <div class="bws_help_box bws_help_box_right dashicons dashicons-editor-help" style="vertical-align: middle;">
                                        <div class="bws_hidden_help_text" style="min-width: 260px;">Do you want to try to get full article content from the linked URL? This will replace the content of the %%item_content%% shortcode.
                        </div>
                    </div>
                    <b>Try to Get Full Article Content:</b>
                    
                    </td><td>
                    <input type="checkbox" id="full_content' . $cont . '" name="newsomatic_rules_list[full_content][]" onchange="mainChanged' . $cont . '()"';
        if($full_content == '1')
        {
            $output .= ' checked';
        }
        $output .= '>               
        </div>
        </td></tr><tr><td>
        <div class="hideFull' . $cont . '">
        <div class="bws_help_box bws_help_box_right dashicons dashicons-editor-help" style="vertical-align: middle;">
                                        <div class="bws_hidden_help_text" style="min-width: 260px;">Select the query type you want to search for the article full content. XPath: <a href="https://www.w3schools.com/xml/xpath_intro.asp" target="_blank">More info/tutorial</a>.
                        </div>
                    </div>
                    <b>Full Content Query Type:</b>
                    </div>
                    </td><td>
                    <div class="hideFull' . $cont . '">
                    <select id="type" name="newsomatic_rules_list[type][]" style="width:100%">
                    <option value="id"';
                    if($type == 'id')
                    {
                        $output .= ' selected';
                    }
                    $output .= '>ID</option>
                    <option value="class"';
                    if($type == 'class')
                    {
                        $output .= ' selected';
                    }
                    $output .= '>Class</option>
                    <option value="xpath"';
                    if($type == 'xpath')
                    {
                        $output .= ' selected';
                    }
                    $output .= '>XPath</option>
                    <option value="regex"';
                    if($type == 'regex')
                    {
                        $output .= ' selected';
                    }
                    $output .= '>Regex</option>
                </select>              
        </div>
        </td></tr><tr><td>
        <div class="hideFull' . $cont . '">
        <div class="bws_help_box bws_help_box_right dashicons dashicons-editor-help" style="vertical-align: middle;">
                                        <div class="bws_hidden_help_text" style="min-width: 260px;">Input the search query for full content searching. This can be the ID or class name you want to search for, the <a href="https://regexone.com/" target="_blank">regex expression</a> you want to apply or the XPath Expression you want to query for. <a href="https://www.w3schools.com/xml/xpath_intro.asp" target="_blank">More info/tutorial</a>.
                        </div>
                    </div>
                    <b>Search Query String:</b>
                    </div>
                    </td><td>
                    <div class="hideFull' . $cont . '">
                    <input type="text" name="newsomatic_rules_list[expre][]" value="' . stripcslashes(htmlspecialchars($expre)) . '" placeholder="Please insert your query" style="width:100%">
                        
        </div>
        </td></tr><tr><td>
        <div class="hideFull' . $cont . '">
        <div class="bws_help_box bws_help_box_right dashicons dashicons-editor-help" style="vertical-align: middle;">
                                        <div class="bws_hidden_help_text" style="min-width: 260px;">Select a percentage of the grabbed content that will be included in the article. This is useful when the author states that you can legally get up to 25% of the full article. To disable this feature, leave this field blank.
                        </div>
                    </div>
                    <b>Percentage Of The Full Content To Keep:</b>
                    </div>
                    </td><td>
                    <div class="hideFull' . $cont . '">
                    <input type="number" min="1" step="1" max="100" name="newsomatic_rules_list[content_percent][]" value="' . $content_percent . '" placeholder="Please insert a percentage" style="width:100%">
                        
        </div>
        </td></tr><tr><td>
        <div class="hideFull' . $cont . '">
        <div class="bws_help_box bws_help_box_right dashicons dashicons-editor-help" style="vertical-align: middle;">
                                        <div class="bws_hidden_help_text" style="min-width: 260px;">Do you want to strip HTML from Full Content?
                        </div>
                    </div>
                    <b>Strip HTML From Full Content:</b>
                    </div>
                    </td><td>
                    <div class="hideFull' . $cont . '">
                    <input type="checkbox" id="only_text" name="newsomatic_rules_list[only_text][]"';
        if($only_text == '1')
        {
            $output .= ' checked';
        }
        $output .= '>               
        </div>
        </td></tr><tr><td>
        <div class="hideFull' . $cont . '">
        <div class="bws_help_box bws_help_box_right dashicons dashicons-editor-help" style="vertical-align: middle;">
                                        <div class="bws_hidden_help_text" style="min-width: 260px;">Do you want to get only one element or all elements that fit the defined rule?
                        </div>
                    </div>
                    <b>Get Only The First Found Element:</b>
                    </div>
                    </td><td>
                    <div class="hideFull' . $cont . '">
                    <input type="checkbox" id="single" name="newsomatic_rules_list[single][]"';
        if($single == '1')
        {
            $output .= ' checked';
        }
        $output .= '>               
        </div>
        </td></tr><tr><td>
        <div class="hideFull' . $cont . '">
        <div class="bws_help_box bws_help_box_right dashicons dashicons-editor-help" style="vertical-align: middle;">
                                        <div class="bws_hidden_help_text" style="min-width: 260px;">Do you want to get only the inner content of the div or the full div (with tags you searched for)?
                        </div>
                    </div>
                    <b>Get Only The Inner Div Content:</b>
                    </div>
                    </td><td>
                    <div class="hideFull' . $cont . '">
                    <input type="checkbox" id="inner" name="newsomatic_rules_list[inner][]"';
        if($inner == '1')
        {
            $output .= ' checked';
        }
        $output .= '>               
        </div>
        </td></tr><tr><td>
        <div class="hideFull' . $cont . '">
        <div class="bws_help_box bws_help_box_right dashicons dashicons-editor-help" style="vertical-align: middle;">
                                        <div class="bws_hidden_help_text" style="min-width: 260px;">Do you want to also get any CSS file content that was included in the scaped URL?
                        </div>
                    </div>
                    <b>Also Get Found CSS Files Content:</b>
                    </div>
                    </td><td>
                    <div class="hideFull' . $cont . '">
                    <input type="checkbox" id="get_css" name="newsomatic_rules_list[get_css][]"';
        if($get_css == '1')
        {
            $output .= ' checked';
        }
        $output .= '>               
        </div>
        </td></tr><tr><td>
        <div class="hideFull' . $cont . '">
        <div class="bws_help_box bws_help_box_right dashicons dashicons-editor-help" style="vertical-align: middle;">
                                        <div class="bws_hidden_help_text" style="min-width: 260px;">Select the source page encoding
                        </div>
                    </div>
                    <b>Source Article Encoding:</b>
                    </div>
                    </td><td>
                    <div class="hideFull' . $cont . '">
                    <select id="encoding" name="newsomatic_rules_list[encoding][]" style="width:100%">
                    <option value="NO_CHANGE"';
                    if($encoding == 'NO_CHANGE')
                    {
                        $output .= ' selected';
                    }
                    $output .= '>Feature Disabled</option>
                    <option value="AUTO"';
                    if($encoding == 'AUTO')
                    {
                        $output .= ' selected';
                    }
                    $output .= '>Auto Detect</option>';
    $i=0;
	foreach($GLOBALS['encodings'] as $enc){
        $output .= '<option value="' . $GLOBALS['encodings'][$i] . '"'; 
        if($encoding == $GLOBALS['encodings'][$i])
        {
            $output .= ' selected';
        }
        $output .= '>' . $GLOBALS['encodings'][$i] . '</option>';
        $i++;
    }
            $output .= '</select>          
        </div>
        </td></tr></table></div> 
    </div>
    <div class="modal-footer">
      <br/>
      <h3 style="display:inline">Newsomatic Automatic Post Generator</h3><span style="display:inline" id="newsomatic_ok' . $cont . '" class="ok">OK&nbsp;</span>
      <br/><br/>
    </div>
  </div>

</div>
<script>
function mainChanged' . $cont . '()
{
    if(jQuery("#full_content' . $cont . '").is(":checked"))
    {            
        jQuery(".hideFull' . $cont . '").show();
    }
    else
    {
        jQuery(".hideFull' . $cont . '").hide();
    } 
}
jQuery( document ).ready(function() {
    mainChanged' . $cont . '();
});
</script>
<script>
var modal' . $cont . ' = document.getElementById("myModal' . $cont . '");
var btn' . $cont . ' = document.getElementById("myBtn' . $cont . '");
var span' . $cont . ' = document.getElementById("newsomatic_close' . $cont . '");
var ok' . $cont . ' = document.getElementById("newsomatic_ok' . $cont . '");
btn' . $cont . '.onclick = function() {
    modal' . $cont . '.style.display = "block";
}
span' . $cont . '.onclick = function() {
    modal' . $cont . '.style.display = "none";
}
ok' . $cont . '.onclick = function() {
    modal' . $cont . '.style.display = "none";
}
modal' . $cont . '.addEventListener("click", function(e){if (e.target !== this)return;modal' . $cont . '.style.display = "none";}, false);
</script>        
                    </td>
						<td style="max-width:20px;text-align: center;"><span class="wpnewsomatic-delete"></span></td>
                        <td style="max-width:32px;text-align:center;vertical-align: middle;"><input type="checkbox" name="newsomatic_rules_list[active][]" value="1"';
            if (isset($active) && $active === '1') {
                $output .= ' checked';
            }
            $output .= '/>
                        <input type="hidden" name="newsomatic_rules_list[last_run][]" value="' . $last_run . '"/></td>
                        <td style="max-width:20px;text-align: center;"><div class="bws_help_box bws_help_box_right dashicons dashicons-editor-help" style="vertical-align: middle;">
                        <div class="bws_hidden_help_text" style="min-width: 260px;">Posts Generated: ' . $generated_posts . '<br/>';
            if ($generated_posts != 0) {
                $output .= '<a href="' . get_admin_url() . 'edit.php?newsomatic_post=p' . $cont . '" target="_blank">View Generated Posts</a><br/>';
            }
            $output .= 'Last Run: ';
            if ($last_run == '1988-01-27 00:00:00') {
                $output .= 'Never';
            } else {
                $output .= $last_run;
            }
            $output .= '<br/>Next Run: ';
            $nextrun = newsomatic_add_hour($last_run, $schedule);
            $now     = newsomatic_get_date_now();
            if ( defined( 'DISABLE_WP_CRON' ) && DISABLE_WP_CRON ) {
                $output .= 'WP-CRON Disabled. Rules will not automatically run!';
            }
            else
            {
                if (isset($active) && $active === '1') {
                    $newsomatic_hour_diff = (int) newsomatic_hour_diff($now, $nextrun);
                    if ($newsomatic_hour_diff >= 0) {
                        $append = 'At most in one hour.';
                        $cron   = _get_cron_array();
                        if ($cron != FALSE) {
                            $date_format = _x('Y-m-d H:i:s', 'Date Time Format1', 'newsomatic-rss-feed-post-generator');
                            foreach ($cron as $timestamp => $cronhooks) {
                                foreach ((array) $cronhooks as $hook => $events) {
                                    if ($hook == 'newsomaticaction') {
                                        foreach ((array) $events as $key => $event) {
                                            $append = date_i18n($date_format, $timestamp) . '.000000';
                                        }
                                    }
                                }
                            }
                        }
                        $output .= $append;
                    } else {
                        $output .= $nextrun;
                    }
                } else {
                    $output .= 'Rule Disabled';
                }
            }
            $output .= '<br/>Local Time: ' . $now;
            $output .= '</div>
                    </div></td>
                        <td style="text-align: center;">
                        <div>
                        <img id="run_img' . $cont . '" src="' . plugin_dir_url(dirname(__FILE__)) . 'images/running.gif' . '" alt="Running" style="float: left;';
            if (!empty($running)) {
                if (!in_array($cont, $running)) {
                    $output .= 'visibility:hidden;';
                }
            } else {
                $output .= 'visibility:hidden;';
            }
            $output .= 'vertical-align: middle;" title="status">
                        <div class="mainselection">
                        <select id="actions" class="actions" name="actions" onchange="actionsChangedManual(' . $cont . ', this.value);" onfocus="this.selectedIndex = 0;">
                            <option value="select" disabled selected>Select an Action</option>
                            <option value="run">Run This Rule Now</option>
                            <option value="trash">Move All Posts To Trash</option>
                            <option value="delete">Permanently Delete All Posts</option>
                        </select>
                        </div>
                        </div>
                        </td>
					</tr>	
					';
            $cont = $cont + 1;
        }
    }
    return $output;
}
?>